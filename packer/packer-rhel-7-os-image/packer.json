{
    "builders": [
	{
        "type": "amazon-ebs",
        "name": "aws-us-gov-west-1",
		"access_key": "{{ user `access_key_aws_gov` }}",
		"secret_key": "{{ user `secret_key_aws_gov` }}",
        "region": "us-gov-west-1",
        "instance_type": "{{ user `instance_type` }}",
        "ssh_username": "{{ user `ssh_username` }}",
        "ami_name": "{{ user `ami_rhel_7_image_name` }}",
        "force_deregister": "true",
        "force_delete_snapshot": "true",
        "vpc_id": "{{ user `vpc_gov_west_1_id` }}",
        "subnet_id": "{{ user `subnet_gov_west_1_id` }}",
        "associate_public_ip_address": "true",
        "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name": "RHEL-7*",
                "root-device-type": "ebs"
            },
            "owners": [219670896067],
            "most_recent": true
        },
        "tags": {
            "Name": "Base RHEL-7 Golden AMI (us-gov-west-1)",
            "BuiltBy": "Packer"
        }
    },
	
	{
        "type": "amazon-ebs",
        "name": "aws-us-gov-east-1",
		"access_key": "{{ user `access_key_aws_gov` }}",
		"secret_key": "{{ user `secret_key_aws_gov` }}",
        "region": "us-gov-east-1",
        "instance_type": "t3a.small",
        "ssh_username": "{{ user `ssh_username` }}",
        "ami_name": "{{ user `rhel_7_image_name` }}",
        "force_deregister": "true",
        "force_delete_snapshot": "true",
        "vpc_id": "{{ user `vpc_gov_east_1_id` }}",
        "subnet_id": "{{ user `subnet_gov_east_1_id` }}",
        "associate_public_ip_address": "true",
        "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name": "RHEL-7*",
                "root-device-type": "ebs"
            },
            "owners": [219670896067],
            "most_recent": true
        },
        "tags": {
            "Name": "Base RHEL-7 Golden AMI (us-gov-east-1)",
            "BuiltBy": "Packer"
        }
    },
	
	{
		"type": "azure-arm",

		"client_id": "{{ user `az_client_id` }}",
		"client_secret": "{{ user `az_client_secret` }}",
		"subscription_id": "{{ user `az_subscription_id` }}",
		"tenant_id": "{{ user `az_tenant_id` }}",

		"managed_image_name": "{{ user `rhel_7_image_name` }}",
		"managed_image_resource_group_name": "RHEL-7-Golden-Image",

		"os_type": "Linux",
		"image_publisher": "RedHat",
		"image_offer": "RHEL",
		"image_sku": "7.8",

		"azure_tags": {
			"Name": "Base MCD RHEL7 Golden Image (Azure)",
			"BuiltBy": "Packer"
		},

		"location": "eastus",
		"vm_size": "Standard_B2s"
	}
	
	],

    "description": "Base RHEL-7 Golden Image",

    "provisioners": [
        {
            "type": "file",
            "source": "files/banner.txt",
            "destination": "$HOME/banner.txt"
        },

		{
			"type": "shell",
			"inline": [
                "sudo yum update -y",
                "sudo cp /etc/issue /etc/issue.orig",
                "sudo cp /etc/motd /etc/motd.orig",
                "sudo cp $HOME/banner.txt /etc/issue",
                "sudo cp $HOME/banner.txt /etc/motd"
            ]
		},
		
		{
			"type": "shell",
			"script": "scripts/os-patch.sh"
		}
        


    ],
    
    "post-processors": [
        [
            {
                "output": "{{user `rhel_7_image_name` }}-manifest.json",
                "strip_path": true,
                "type": "manifest",
                "only": ["aws-us-gov-east-1"]
            }
        ]
    ]
    

}